<!-- 
  WEBFLOW RAFFLE EMBED - COMPLETE STANDALONE CODE
  Copy this entire code and paste it into a Webflow Embed element
  
  Features:
  - Single raffle display
  - MetaMask wallet connection
  - Payment to your wallet: 0x842bab27de95e329eb17733c1f29c082e5dd94c3
  - Transaction history display
  - Fully functional and styled
-->

<div id="raffle-widget" style="font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 800px; margin: 0 auto;">
  <!-- Wallet Connection -->
  <div id="wallet-section" style="margin-bottom: 2rem;">
    <button id="connectWalletBtn" style="
      width: 100%;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
      box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
    " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
      <span id="walletBtnText">üëõ Connect Wallet to Enter Raffle</span>
    </button>
    
    <div id="walletInfo" style="display: none; margin-top: 1rem; padding: 1rem; background: #f3f4f6; border-radius: 8px; text-align: center;">
      <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">Connected Wallet</div>
      <div id="walletAddress" style="font-size: 1rem; font-weight: 600; color: #111827; font-family: monospace;"></div>
    </div>
  </div>

  <!-- Raffle Card -->
  <div id="raffle-card" style="
    background: linear-gradient(135deg, #1a1f3a 0%, #2d1b4e 100%);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(99, 102, 241, 0.3);
    color: white;
  ">
    <!-- Raffle Header -->
    <div style="text-align: center; margin-bottom: 2rem;">
      <div style="font-size: 3rem; margin-bottom: 1rem;">üé∞</div>
      <h2 style="font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
        Win 0.01 ETH Raffle!
      </h2>
      <p style="color: #9ca3af; font-size: 1rem;">Enter for a chance to win big!</p>
    </div>

    <!-- Raffle Stats -->
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 2rem;">
      <div style="background: rgba(99, 102, 241, 0.1); padding: 1rem; border-radius: 12px; text-align: center;">
        <div style="font-size: 0.875rem; color: #9ca3af; margin-bottom: 0.5rem;">Prize Pool</div>
        <div style="font-size: 1.5rem; font-weight: 700; color: #10b981;">0.01 ETH</div>
      </div>
      <div style="background: rgba(99, 102, 241, 0.1); padding: 1rem; border-radius: 12px; text-align: center;">
        <div style="font-size: 0.875rem; color: #9ca3af; margin-bottom: 0.5rem;">Entry Fee</div>
        <div style="font-size: 1.5rem; font-weight: 700; color: #6366f1;">0.001 ETH</div>
      </div>
    </div>

    <!-- Entry Button -->
    <button id="enterRaffleBtn" style="
      width: 100%;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border: none;
      padding: 1.25rem;
      border-radius: 12px;
      font-size: 1.125rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
      margin-bottom: 1rem;
    " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'" disabled>
      üîí Connect Wallet to Enter
    </button>

    <!-- Participants Count -->
    <div style="text-align: center; padding: 1rem; background: rgba(99, 102, 241, 0.1); border-radius: 12px;">
      <div style="font-size: 0.875rem; color: #9ca3af; margin-bottom: 0.5rem;">Total Entries</div>
      <div id="participantCount" style="font-size: 1.5rem; font-weight: 700;">0</div>
    </div>
  </div>

  <!-- Transaction History -->
  <div id="transaction-history" style="margin-top: 2rem;">
    <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #111827;">
      üìú Recent Entries
    </h3>
    <div id="transactionList" style="
      background: white;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      max-height: 400px;
      overflow-y: auto;
    ">
      <div style="text-align: center; padding: 2rem; color: #6b7280;">
        No entries yet. Be the first to enter!
      </div>
    </div>
  </div>

  <!-- Status Message -->
  <div id="statusMessage" style="
    display: none;
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    min-width: 300px;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    font-weight: 600;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    text-align: center;
  "></div>
</div>

<!-- Load ethers.js -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<script>
(function() {
  // Configuration
  const RAFFLE_CONFIG = {
    YOUR_WALLET: '0x842bab27de95e329eb17733c1f29c082e5dd94c3',
    ENTRY_FEE: '0.001', // ETH
    PRIZE_POOL: '0.01', // ETH
    RAFFLE_ID: 'raffle_' + Date.now()
  };

  // State
  let walletState = {
    isConnected: false,
    address: null,
    provider: null,
    signer: null
  };

  let transactions = [];

  // Elements
  const connectBtn = document.getElementById('connectWalletBtn');
  const enterBtn = document.getElementById('enterRaffleBtn');
  const walletInfo = document.getElementById('walletInfo');
  const walletAddress = document.getElementById('walletAddress');
  const walletBtnText = document.getElementById('walletBtnText');
  const participantCount = document.getElementById('participantCount');
  const transactionList = document.getElementById('transactionList');
  const statusMessage = document.getElementById('statusMessage');

  // Show status message
  function showStatus(message, type = 'info') {
    statusMessage.textContent = message;
    statusMessage.style.display = 'block';
    
    if (type === 'success') {
      statusMessage.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
      statusMessage.style.color = 'white';
    } else if (type === 'error') {
      statusMessage.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
      statusMessage.style.color = 'white';
    } else {
      statusMessage.style.background = 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)';
      statusMessage.style.color = 'white';
    }

    setTimeout(() => {
      statusMessage.style.display = 'none';
    }, 5000);
  }

  // Connect wallet
  async function connectWallet() {
    // Check for mobile
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    if (typeof window.ethereum === 'undefined') {
      if (isMobile) {
        showStatus('üì± Opening MetaMask app...', 'info');
        const currentUrl = window.location.href;
        window.location.href = `https://metamask.app.link/dapp/${currentUrl.replace(/^https?:\/\//, '')}`;
        return;
      } else {
        showStatus('‚ùå MetaMask not installed!', 'error');
        window.open('https://metamask.io/download/', '_blank');
        return;
      }
    }

    try {
      connectBtn.disabled = true;
      walletBtnText.textContent = '‚è≥ Connecting...';
      showStatus('ü¶ä Opening MetaMask...', 'info');

      const accounts = await window.ethereum.request({ 
        method: 'eth_requestAccounts' 
      });

      if (accounts.length === 0) {
        showStatus('‚ùå No accounts found', 'error');
        walletBtnText.textContent = 'üëõ Connect Wallet to Enter Raffle';
        connectBtn.disabled = false;
        return;
      }

      walletState.provider = new ethers.providers.Web3Provider(window.ethereum);
      walletState.signer = walletState.provider.getSigner();
      walletState.address = accounts[0];
      walletState.isConnected = true;

      // Update UI
      connectBtn.style.display = 'none';
      walletInfo.style.display = 'block';
      walletAddress.textContent = `${accounts[0].slice(0, 6)}...${accounts[0].slice(-4)}`;
      
      enterBtn.disabled = false;
      enterBtn.textContent = 'üé´ Enter Raffle Now (0.001 ETH)';
      enterBtn.style.cursor = 'pointer';

      showStatus('‚úÖ Wallet connected!', 'success');
      loadTransactions();

    } catch (error) {
      console.error('Error connecting:', error);
      connectBtn.disabled = false;
      walletBtnText.textContent = 'üëõ Connect Wallet to Enter Raffle';
      
      if (error.code === 4001) {
        showStatus('‚ùå Connection rejected', 'error');
      } else {
        showStatus('‚ùå Error: ' + error.message, 'error');
      }
    }
  }

  // Enter raffle
  async function enterRaffle() {
    if (!walletState.isConnected) {
      showStatus('‚ùå Please connect wallet first!', 'error');
      return;
    }

    try {
      enterBtn.disabled = true;
      enterBtn.textContent = '‚è≥ Processing...';
      showStatus('üí≥ Preparing transaction...', 'info');

      // Check balance
      const balance = await walletState.provider.getBalance(walletState.address);
      const balanceInEth = ethers.utils.formatEther(balance);
      
      if (parseFloat(balanceInEth) < parseFloat(RAFFLE_CONFIG.ENTRY_FEE)) {
        showStatus('‚ùå Insufficient balance!', 'error');
        enterBtn.disabled = false;
        enterBtn.textContent = 'üé´ Enter Raffle Now (0.001 ETH)';
        return;
      }

      showStatus('üí≥ Please approve transaction in MetaMask...', 'info');

      // Send transaction
      const tx = await walletState.signer.sendTransaction({
        to: RAFFLE_CONFIG.YOUR_WALLET,
        value: ethers.utils.parseEther(RAFFLE_CONFIG.ENTRY_FEE)
      });

      showStatus('‚è≥ Transaction submitted. Waiting for confirmation...', 'info');

      // Wait for confirmation
      const receipt = await tx.wait();

      // Save transaction
      const newTx = {
        from: walletState.address,
        amount: RAFFLE_CONFIG.ENTRY_FEE,
        txHash: receipt.transactionHash,
        timestamp: Date.now(),
        blockNumber: receipt.blockNumber
      };

      transactions.push(newTx);
      saveTransactions();
      updateTransactionList();
      updateParticipantCount();

      showStatus('üéâ Success! You entered the raffle!', 'success');
      
      enterBtn.disabled = false;
      enterBtn.textContent = 'üé´ Enter Again (0.001 ETH)';

    } catch (error) {
      console.error('Error entering raffle:', error);
      enterBtn.disabled = false;
      enterBtn.textContent = 'üé´ Enter Raffle Now (0.001 ETH)';
      
      if (error.code === 4001) {
        showStatus('‚ùå Transaction rejected', 'error');
      } else {
        showStatus('‚ùå Error: ' + error.message, 'error');
      }
    }
  }

  // Save transactions to localStorage
  function saveTransactions() {
    try {
      localStorage.setItem('raffle_transactions_' + RAFFLE_CONFIG.RAFFLE_ID, JSON.stringify(transactions));
    } catch (e) {
      console.error('Error saving transactions:', e);
    }
  }

  // Load transactions from localStorage
  function loadTransactions() {
    try {
      const saved = localStorage.getItem('raffle_transactions_' + RAFFLE_CONFIG.RAFFLE_ID);
      if (saved) {
        transactions = JSON.parse(saved);
        updateTransactionList();
        updateParticipantCount();
      }
    } catch (e) {
      console.error('Error loading transactions:', e);
    }
  }

  // Update transaction list display
  function updateTransactionList() {
    if (transactions.length === 0) {
      transactionList.innerHTML = `
        <div style="text-align: center; padding: 2rem; color: #6b7280;">
          No entries yet. Be the first to enter!
        </div>
      `;
      return;
    }

    const sortedTx = [...transactions].sort((a, b) => b.timestamp - a.timestamp);
    
    transactionList.innerHTML = sortedTx.map((tx, index) => `
      <div style="
        padding: 1rem;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
      ">
        <div>
          <div style="font-weight: 600; color: #111827; font-family: monospace; font-size: 0.875rem;">
            ${tx.from.slice(0, 6)}...${tx.from.slice(-4)}
          </div>
          <div style="font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem;">
            ${new Date(tx.timestamp).toLocaleString()}
          </div>
        </div>
        <div style="text-align: right;">
          <div style="font-weight: 700; color: #10b981;">${tx.amount} ETH</div>
          <a href="https://etherscan.io/tx/${tx.txHash}" target="_blank" style="
            font-size: 0.75rem;
            color: #6366f1;
            text-decoration: none;
          ">View TX ‚Üó</a>
        </div>
      </div>
    `).join('');
  }

  // Update participant count
  function updateParticipantCount() {
    participantCount.textContent = transactions.length;
  }

  // Event listeners
  connectBtn.addEventListener('click', connectWallet);
  enterBtn.addEventListener('click', enterRaffle);

  // Handle account changes
  if (window.ethereum) {
    window.ethereum.on('accountsChanged', (accounts) => {
      if (accounts.length === 0) {
        walletState.isConnected = false;
        walletState.address = null;
        connectBtn.style.display = 'block';
        walletInfo.style.display = 'none';
        enterBtn.disabled = true;
        enterBtn.textContent = 'üîí Connect Wallet to Enter';
        showStatus('üëã Wallet disconnected', 'info');
      } else {
        walletState.address = accounts[0];
        walletAddress.textContent = `${accounts[0].slice(0, 6)}...${accounts[0].slice(-4)}`;
        showStatus('üîÑ Wallet switched', 'info');
      }
    });

    window.ethereum.on('chainChanged', () => {
      window.location.reload();
    });
  }

  // Load transactions on init
  loadTransactions();

  console.log('‚úÖ Raffle widget initialized');
  console.log('üí∞ Payments go to:', RAFFLE_CONFIG.YOUR_WALLET);
})();
</script>

<style>
/* Scrollbar styling */
#transactionList::-webkit-scrollbar {
  width: 8px;
}

#transactionList::-webkit-scrollbar-track {
  background: #f3f4f6;
  border-radius: 4px;
}

#transactionList::-webkit-scrollbar-thumb {
  background: #6366f1;
  border-radius: 4px;
}

/* Mobile responsive */
@media (max-width: 768px) {
  #raffle-widget {
    padding: 0 1rem;
  }
  
  #raffle-card {
    padding: 1.5rem;
  }
  
  #raffle-card h2 {
    font-size: 1.5rem;
  }
}
</style>

<!-- 
  USAGE INSTRUCTIONS:
  
  1. Copy this ENTIRE code
  2. In Webflow, add an "Embed" element where you want the raffle
  3. Paste this code into the embed
  4. Publish your site
  5. Done! The raffle will work immediately
  
  FEATURES:
  - Payments go directly to: 0x842bab27de95e329eb17733c1f29c082e5dd94c3
  - Shows transaction history below raffle
  - Stores entries in browser localStorage
  - Works on mobile and desktop
  - MetaMask integration included
  - Fully styled and ready to use
  
  CUSTOMIZATION:
  - Change entry fee: Edit ENTRY_FEE value (line 165)
  - Change prize: Edit PRIZE_POOL value (line 166)
  - Change title: Edit the h2 text (line 54)
  - Change description: Edit the p text (line 57)
-->
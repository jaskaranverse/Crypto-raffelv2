<!-- 
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  WEBFLOW EMBED #1: WALLET CONNECT
  
  What it does:
  - Connects user's MetaMask wallet
  - Shows connected wallet address
  - Allows disconnect
  
  How to use in Webflow:
  1. Add an Embed element
  2. Copy this ENTIRE code
  3. Paste into the embed
  4. Publish
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->

<div id="wallet-widget" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
  <!-- Connect Button -->
  <button id="connectWalletBtn" style="
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 14px 28px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 12px rgba(0,0,0,0.15)'" 
     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)'">
    <span id="walletBtnText">ðŸ‘› Connect Wallet</span>
  </button>

  <!-- Connected Wallet Display -->
  <div id="walletInfo" style="display: none; margin-top: 16px; padding: 20px; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 12px; border: 2px solid #10b981;">
    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
      <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">
        âœ“
      </div>
      <div style="flex: 1;">
        <div style="font-size: 12px; color: #065f46; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Connected</div>
        <div id="walletAddress" style="font-size: 16px; font-weight: 700; color: #047857; font-family: 'Courier New', monospace;"></div>
        <div id="networkName" style="font-size: 12px; color: #059669; margin-top: 2px;"></div>
      </div>
    </div>
    <button id="disconnectBtn" style="
      background: #ef4444;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: background 0.2s;
    " onmouseover="this.style.background='#dc2626'" onmouseout="this.style.background='#ef4444'">
      Disconnect Wallet
    </button>
  </div>

  <!-- Status Messages -->
  <div id="statusMsg" style="display: none; margin-top: 12px; padding: 12px 16px; border-radius: 8px; font-size: 14px; font-weight: 500;"></div>
</div>

<script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
<script>
(function() {
  'use strict';
  
  // Global wallet state
  window.RAFFLE_WALLET = {
    isConnected: false,
    address: null,
    chainId: null,
    provider: null,
    signer: null
  };

  const elements = {
    connectBtn: document.getElementById('connectWalletBtn'),
    disconnectBtn: document.getElementById('disconnectBtn'),
    walletInfo: document.getElementById('walletInfo'),
    walletAddress: document.getElementById('walletAddress'),
    networkName: document.getElementById('networkName'),
    walletBtnText: document.getElementById('walletBtnText'),
    statusMsg: document.getElementById('statusMsg')
  };

  function showStatus(message, type = 'info') {
    const colors = {
      success: { bg: '#d1fae5', text: '#065f46', border: '#10b981' },
      error: { bg: '#fee2e2', text: '#991b1b', border: '#ef4444' },
      info: { bg: '#dbeafe', text: '#1e40af', border: '#3b82f6' }
    };
    
    const color = colors[type];
    elements.statusMsg.textContent = message;
    elements.statusMsg.style.display = 'block';
    elements.statusMsg.style.background = color.bg;
    elements.statusMsg.style.color = color.text;
    elements.statusMsg.style.border = `1px solid ${color.border}`;

    setTimeout(() => elements.statusMsg.style.display = 'none', 5000);
  }

  function getNetworkName(chainId) {
    const networks = {
      '0x1': 'Ethereum Mainnet',
      '0x5': 'Goerli',
      '0xaa36a7': 'Sepolia',
      '0x89': 'Polygon',
      '0x13881': 'Mumbai',
      '0xa': 'Optimism',
      '0xa4b1': 'Arbitrum'
    };
    return networks[chainId] || `Chain ${chainId}`;
  }

  async function connectWallet() {
    if (typeof window.ethereum === 'undefined') {
      showStatus('âŒ MetaMask not installed! Please install MetaMask.', 'error');
      window.open('https://metamask.io/download/', '_blank');
      return;
    }

    try {
      elements.connectBtn.disabled = true;
      elements.walletBtnText.textContent = 'â³ Connecting...';
      showStatus('ðŸ¦Š Opening MetaMask...', 'info');

      await window.ethereum.request({
        method: 'wallet_requestPermissions',
        params: [{ eth_accounts: {} }]
      });

      const accounts = await window.ethereum.request({ method: 'eth_accounts' });
      
      if (accounts.length === 0) {
        throw new Error('No accounts found');
      }

      const account = accounts[0];
      const chainId = await window.ethereum.request({ method: 'eth_chainId' });

      if (typeof ethers !== 'undefined') {
        window.RAFFLE_WALLET.provider = new ethers.providers.Web3Provider(window.ethereum);
        window.RAFFLE_WALLET.signer = window.RAFFLE_WALLET.provider.getSigner();
      }

      window.RAFFLE_WALLET.isConnected = true;
      window.RAFFLE_WALLET.address = account;
      window.RAFFLE_WALLET.chainId = chainId;

      elements.connectBtn.style.display = 'none';
      elements.walletInfo.style.display = 'block';
      elements.walletAddress.textContent = `${account.slice(0, 6)}...${account.slice(-4)}`;
      elements.networkName.textContent = getNetworkName(chainId);

      showStatus(`âœ… Connected to ${getNetworkName(chainId)}!`, 'success');

      window.dispatchEvent(new CustomEvent('walletConnected', { 
        detail: window.RAFFLE_WALLET
      }));

    } catch (error) {
      console.error('Connection error:', error);
      elements.connectBtn.disabled = false;
      elements.walletBtnText.textContent = 'ðŸ‘› Connect Wallet';
      showStatus(error.code === 4001 ? 'âŒ Connection rejected' : `âŒ ${error.message}`, 'error');
    }
  }

  function disconnectWallet() {
    window.RAFFLE_WALLET = {
      isConnected: false,
      address: null,
      chainId: null,
      provider: null,
      signer: null
    };

    elements.connectBtn.style.display = 'block';
    elements.connectBtn.disabled = false;
    elements.walletInfo.style.display = 'none';
    elements.walletBtnText.textContent = 'ðŸ‘› Connect Wallet';

    showStatus('ðŸ‘‹ Wallet disconnected', 'info');
    window.dispatchEvent(new CustomEvent('walletDisconnected'));
  }

  async function checkConnection() {
    if (typeof window.ethereum === 'undefined') return;

    try {
      const accounts = await window.ethereum.request({ method: 'eth_accounts' });
      if (accounts.length > 0) {
        const account = accounts[0];
        const chainId = await window.ethereum.request({ method: 'eth_chainId' });

        if (typeof ethers !== 'undefined') {
          window.RAFFLE_WALLET.provider = new ethers.providers.Web3Provider(window.ethereum);
          window.RAFFLE_WALLET.signer = window.RAFFLE_WALLET.provider.getSigner();
        }

        window.RAFFLE_WALLET.isConnected = true;
        window.RAFFLE_WALLET.address = account;
        window.RAFFLE_WALLET.chainId = chainId;

        elements.connectBtn.style.display = 'none';
        elements.walletInfo.style.display = 'block';
        elements.walletAddress.textContent = `${account.slice(0, 6)}...${account.slice(-4)}`;
        elements.networkName.textContent = getNetworkName(chainId);

        window.dispatchEvent(new CustomEvent('walletConnected', { 
          detail: window.RAFFLE_WALLET
        }));
      }
    } catch (error) {
      console.error('Check connection error:', error);
    }
  }

  function handleAccountsChanged(accounts) {
    if (accounts.length === 0) {
      disconnectWallet();
    } else if (accounts[0] !== window.RAFFLE_WALLET.address) {
      window.RAFFLE_WALLET.address = accounts[0];
      elements.walletAddress.textContent = `${accounts[0].slice(0, 6)}...${accounts[0].slice(-4)}`;
      showStatus(`ðŸ”„ Switched to ${accounts[0].slice(0, 6)}...${accounts[0].slice(-4)}`, 'info');
      window.dispatchEvent(new CustomEvent('walletChanged', { detail: { address: accounts[0] } }));
    }
  }

  elements.connectBtn.addEventListener('click', connectWallet);
  elements.disconnectBtn.addEventListener('click', disconnectWallet);

  if (window.ethereum) {
    window.ethereum.on('accountsChanged', handleAccountsChanged);
    window.ethereum.on('chainChanged', () => window.location.reload());
  }

  checkConnection();
  console.log('âœ… Wallet widget loaded');
})();
</script>